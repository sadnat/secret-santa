<%
const activeTheme = typeof currentTheme !== 'undefined' ? currentTheme : 'default';

const body = `
<div class="container admin-page">
  <h1>Administration</h1>
  
  <div class="admin-stats">
    <div class="stat-card">
      <h3>${organizerCount}</h3>
      <p>Utilisateurs</p>
      <a href="/admin/users" class="btn btn-secondary">Gerer</a>
    </div>
    <div class="stat-card">
      <h3>${groupCount}</h3>
      <p>Groupes</p>
      <a href="/admin/groups" class="btn btn-secondary">Gerer</a>
    </div>
    <div class="stat-card">
      <h3>${participantCount}</h3>
      <p>Participants</p>
    </div>
    <div class="stat-card ${pendingDrawCount > 0 ? 'stat-warning' : 'stat-success'}">
      <h3>${pendingDrawCount}</h3>
      <p>Tirages en attente</p>
    </div>
  </div>

  <section class="settings-section">
    <h2>Theme du site</h2>
    <p style="color: var(--text-muted); margin-bottom: 1rem;">Choisissez l'apparence du site. Le theme de Noel ajoute des decorations festives (flocons, emojis, animations).</p>
    <div class="theme-selector">
      <form action="/admin/settings/theme" method="POST" style="display: contents;">
        <input type="hidden" name="_csrf" value="${csrfToken}">
        <input type="hidden" name="theme" value="default" id="theme-default-input">
        <div class="theme-option ${activeTheme === 'default' ? 'active' : ''}" onclick="document.getElementById('theme-default-input').closest('form').querySelector('[name=theme]').value='default'; this.closest('form').submit();">
          <div class="theme-preview">
            <span class="swatch" style="background: #5C6BC0;"></span>
            <span class="swatch" style="background: #26A69A;"></span>
          </div>
          <h4>Par defaut</h4>
          <p>Design sobre et moderne, ideal toute l'annee.</p>
          ${activeTheme === 'default' ? '<span class="badge badge-active">Actif</span>' : '<button type="submit" class="btn btn-small btn-primary">Activer</button>'}
        </div>
      </form>
      <form action="/admin/settings/theme" method="POST" style="display: contents;">
        <input type="hidden" name="_csrf" value="${csrfToken}">
        <input type="hidden" name="theme" value="noel">
        <div class="theme-option ${activeTheme === 'noel' ? 'active' : ''}" onclick="this.closest('form').submit();">
          <div class="theme-preview">
            <span class="swatch" style="background: #c41e3a;"></span>
            <span class="swatch" style="background: #228b22;"></span>
          </div>
          <h4>Noel</h4>
          <p>Flocons, emojis festifs et couleurs de Noel.</p>
          ${activeTheme === 'noel' ? '<span class="badge badge-active">Actif</span>' : '<button type="submit" class="btn btn-small btn-primary">Activer</button>'}
        </div>
      </form>
    </div>
  </section>

  <div class="admin-nav">
    <h2>Actions rapides</h2>
    <ul>
      <li><a href="/admin/users">Voir tous les utilisateurs</a></li>
      <li><a href="/admin/groups">Voir tous les groupes</a></li>
      <li><a href="/admin/logs">Journal d'activite</a></li>
      <li><a href="/organizer/dashboard">Retour a mes groupes</a></li>
    </ul>
  </div>
</div>

<style>
  .admin-stats {
    display: flex;
    gap: 2rem;
    margin: 2rem 0;
    flex-wrap: wrap;
  }
  .stat-card h3 {
    font-size: 2.5rem;
    margin: 0;
  }
  .stat-card p {
    margin: 0.5rem 0 1rem;
    color: #666;
  }
  .admin-nav {
    margin-top: 2rem;
  }
  .admin-nav ul {
    list-style: none;
    padding: 0;
  }
  .admin-nav li {
    margin: 0.5rem 0;
  }
  .admin-nav a {
    color: var(--primary-color);
  }
</style>
`;
%>
<%- include('../layout', { title: 'Administration', organizer, body }) %>
