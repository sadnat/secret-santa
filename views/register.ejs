<%
const escapeHtml = (str) => str ? String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;') : '';
const groupNameDisplay = typeof group !== 'undefined' && group ? group.name : '';
const formAction = typeof groupCode !== 'undefined' && groupCode ? `/join/${groupCode}` : '/register';

const body = `
<div class="form-page">
  <h1>Inscription</h1>
  ${groupNameDisplay ? `<p class="group-context">Vous rejoignez le groupe : <strong>${escapeHtml(groupNameDisplay)}</strong></p>` : ''}

  ${typeof group !== 'undefined' && group && (group.budget || group.event_date) ? `
  <div class="alert alert-info">
    ${group.budget ? '<strong>Budget sugere :</strong> ' + escapeHtml(group.budget) : ''}
    ${group.budget && group.event_date ? ' &mdash; ' : ''}
    ${group.event_date ? '<strong>Date de l&#39;evenement :</strong> ' + new Date(group.event_date + 'T00:00:00').toLocaleDateString('fr-FR') : ''}
  </div>
  ` : ''}

  ${error ? '<div class="alert alert-error">' + escapeHtml(error) + '</div>' : ''}

  <form action="${formAction}" method="POST" class="register-form">
    <input type="hidden" name="_csrf" value="${csrfToken}">
    <div class="form-section">
      <h2>Informations personnelles</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="first_name">Prenom *</label>
          <input type="text" id="first_name" name="first_name" required
                 value="${escapeHtml(formData.first_name || '')}"
                 placeholder="Votre prenom">
        </div>
        <div class="form-group">
          <label for="last_name">Nom *</label>
          <input type="text" id="last_name" name="last_name" required
                 value="${escapeHtml(formData.last_name || '')}"
                 placeholder="Votre nom">
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input type="email" id="email" name="email" required
               value="${escapeHtml(formData.email || '')}"
               placeholder="votre@email.com">
        <small>Vous recevrez votre tirage a cette adresse.</small>
      </div>
    </div>

    <div class="form-section">
      <h2>Vos souhaits (optionnel)</h2>
      <p class="section-description">Donnez des idees a votre Secret Santa !</p>

      <div class="form-group">
        <label for="wish1">Souhait 1</label>
        <input type="text" id="wish1" name="wish1"
               value="${escapeHtml(formData.wish1 || '')}"
               placeholder="Ex: Un livre de cuisine">
      </div>
      <div class="form-group">
        <label for="wish2">Souhait 2</label>
        <input type="text" id="wish2" name="wish2"
               value="${escapeHtml(formData.wish2 || '')}"
               placeholder="Ex: Des chaussettes rigolotes">
      </div>
      <div class="form-group">
        <label for="wish3">Souhait 3</label>
        <input type="text" id="wish3" name="wish3"
               value="${escapeHtml(formData.wish3 || '')}"
               placeholder="Ex: Du chocolat">
      </div>
    </div>

    <button type="submit" class="btn btn-primary btn-large">S&#39;inscrire</button>
  </form>
</div>
` %>
<%- include('layout', { title, organizer: null, body }) %>
